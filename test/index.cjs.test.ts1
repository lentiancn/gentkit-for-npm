import { describe, it, expect, expectTypeOf } from 'vitest'
import type * as indexTypes from '../cjs/index.d.cts'
import * as index from '../cjs/index.cjs'

describe('built package testing', () => {
    it('should work with built ESM files', async () => {
        // 动态导入构建后的文件
        const builtModule = await import('../esm/index.js')
        expect(builtModule.format).toBeDefined()
    })

    it('should work with built CJS files', () => {
        const builtCjs = require('../cjs/index.cjs')
        expect(builtCjs.format).toBeDefined()
    })

    it('should be able to call format function from built CJS', () => {
        const builtCjs = require('../cjs/index.cjs')

        // 验证 format 函数可以正常调用
        const testDate = new Date(2025, 3, 16, 17, 18, 19)
        const result = builtCjs.format('YYYY-MM-DD', testDate)

        expect(result).toBe('2025-04-DD')
        expect(typeof result).toBe('string')
    })

    it('should have all expected functions callable', () => {
        const builtCjs = require('../cjs/index.cjs')

        // 获取所有导出的属性
        const exportedKeys = Object.keys(builtCjs)

        // 验证每个导出的函数都是可调用的
        exportedKeys.forEach(key => {
            const exportedItem = builtCjs[key]
            if (typeof exportedItem === 'function') {
                expect(typeof exportedItem).toBe('function')
                // 对于已知的 format 函数，进行具体功能测试
                if (key === 'format') {
                    const testResult = exportedItem('YYYY', new Date(2025, 0, 1))
                    expect(typeof testResult).toBe('string')
                    expect(testResult).toBe('2025')
                }
            }
        })
    })
})

